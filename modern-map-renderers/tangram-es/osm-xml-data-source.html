

<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>OSM XML Data Source · The Outpost</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="I have added an OSM XML data source to Tangram ES as a prototype to demonstrate Tangram ES' capability to be used in an OSM editor.">
        <meta name="generator" content="GitBook 3.0.3">
        <meta name="keywords" content="Nick Hallahan,maps,GIS,Android,POSM,OpenMapKit,map renderers,Tangram">
        <meta name="author" content="Nicholas Hallahan">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="installation.html" />
    
    
    <link rel="prev" href="mbtiles.html" />
    

        <link rel="shortcut icon" href="/images/favicon.png" type="image/png">
    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            <div class="site-heading">
                <div class="site-name">The Outpost</div>
                
                <div id="book-search-input" role="search">
                    <form id="search-form">
                        <input type="text" placeholder="Search The Outpost" />
                    </form>
                </div>
                
            </div>
            
                <nav role="navigation">
                


<ul class="summary">
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Welcome
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../openmapkit/">
            
                <a href="../../openmapkit/">
            
                    
                    OpenMapKit
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../openmapkit/android.html">
            
                <a href="../../openmapkit/android.html">
            
                    
                    OpenMapKit Android
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../../openmapkit/server.html">
            
                <a href="../../openmapkit/server.html">
            
                    
                    OpenMapKit Server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../posm/">
            
                <a href="../../posm/">
            
                    
                    POSM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../posm/story.html">
            
                <a href="../../posm/story.html">
            
                    
                    The Story
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../../posm/hardware.html">
            
                <a href="../../posm/hardware.html">
            
                    
                    Hardware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../posm/software.html">
            
                <a href="../../posm/software.html">
            
                    
                    Software
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="./">
            
                <a href="./">
            
                    
                    Tangram ES
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="mbtiles.html">
            
                <a href="mbtiles.html">
            
                    
                    Offline MBTiles Support
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.1.2" data-path="osm-xml-data-source.html">
            
                <a href="osm-xml-data-source.html">
            
                    
                    OSM XML Data Source
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="installation.html">
            
                <a href="installation.html">
            
                    
                    Android Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="jni.html">
            
                <a href="jni.html">
            
                    
                    Android JNI Bridge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="tangram-android-sdk.html">
            
                <a href="tangram-android-sdk.html">
            
                    
                    Tangram Android SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="notes-tips-and-tricks.html">
            
                <a href="notes-tips-and-tricks.html">
            
                    
                    Notes, Tips and Tricks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../leaflet/">
            
                <a href="../../leaflet/">
            
                    
                    Leaflet Plugins
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../resume/">
            
                <a href="../../resume/">
            
                    
                    Résumé
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../wiki/">
            
                <a href="../../wiki/">
            
                    
                    Wiki
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >OSM XML Data Source</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                            <div id="book-search-results">
                                <div class="search-noresults">
                                    <section class="normal markdown-section">
                                    
                                    <h1 id="tangram-osm-xml-data-source">Tangram OSM XML Data Source</h1>
<p><em>Thu Aug 25 2016</em></p>
<h2 id="overview">Overview</h2>
<p>Because Mapzen currently supports vector tiles in 3 formats: TopoJSON, GeoJSON and Mapbox vector tiles, it is relatively straightforward to add support for additional data sources. In working on <a href="https://github.com/AmericanRedCross/OpenMapKitAndroid" _target="blank">OpenMapKit</a>, I have spent some time thinking about the internals involved with editing and working with OpenStreetMap data. We have been searching long and hard for a new map renderer, and my desire is to do it in a way that OSM data really is a first-class citizen in the mapping library. <strong>My thought is that adding OSM XML support is the first step toward creating an OSM editor with Tangram.</strong></p>
<h2 id="osm-xml-tiles">OSM XML Tiles</h2>
<p>I like that Tangram&apos;s data pipeline revolves around the notion of a tile. Although JOSM does not <em>think</em> that way, iD actually does. Individual <code>GET</code> requests are made to the OSM Editing API (0.6) for the bbox of a given tile. It turns out we can <a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/core/src/data/osmXmlSource.cpp#L51-L73" _target="blank">do the same thing</a> in Tangram ES. </p>
<p>I built a prototype that takes the approach of directly requesting OSM XML from the OSM Editing API. This XML is then parsed into an OSM data model, similar to what you will see in JOSM and OpenMapKit. We have an in-memory data set for a given tile with access to the <a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/core/src/osm/element.h" _target="blank">OSM elements</a> themselves (<a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/core/src/osm/node.h" _target="blank">nodes</a>, <a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/core/src/osm/way.h" _target="blank">ways</a>, and <a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/core/src/osm/relation.h" _target="blank">relations</a>). In addition, we can <a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/core/src/osm/memoryDataSet.h#L49" _target="blank">create a <code>Tangram::Layer</code></a> from the dataset, allowing tiles to be <a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/core/src/data/osmXmlSource.cpp#L36-L47" _target="blank">rendered in a similar manner</a> to vector tiles. We loop through the standalone nodes for points, open ways for lines, and closed ways for polygons.</p>
<h2 id="xml-parser">XML Parser</h2>
<p>I&apos;m using <a href="http://pugixml.org/" _target="blank">pugixml</a> to parse the XML. pugixml is a <em>light-weight, simple and fast XML parser for C++</em>. In addition to fantastic documentation, the library has no dependencies. You can simply add the three source files to the project and include the library&apos;s main header file when needed. It is a DOM parser only, but this is sufficient, since the XML being parsed should only comprise of the data within a tile at zoom 16. This usually amounts to less than 500kb.</p>
<h2 id="basis-for-offline-osm-data-store">Basis for Offline OSM Data Store</h2>
<p>Direct OSM XML support makes sense online, but the deeper goal for me is to make this work from an offline-data store (SQLite). With that in mind, I&apos;m making the <a href="https://github.com/hallahan/tangram-es/blob/OSM_XML/core/src/osm/memoryDataSet.h" _target="blank">MemoryDataSet</a> a child to an abstract DataSet class. That way we can later create a SQLiteDataSet class that queries a database for OSM objects--an alternative to hitting an online REST endpoint.</p>
<h2 id="styling-and-rendering">Styling and Rendering</h2>
<p>There are a couple of challenges with rendering direct OSM data. In particular, current Mapzen data is built around the concept of layers. Different elements are grouped into layers such as <em>roads</em> or <em>buildings</em>. OSM data is flat and instead is given context by tags. Therefore, all of the direct OSM XML data is in a single layer called <code>osmXml</code>. From this layer, we can easily filter elements based on their tag properties and style them accordingly.</p>
<p><a href="https://cloud.githubusercontent.com/assets/556367/17194771/b6895ab6-540e-11e6-92db-02a7908df54d.png" _target="blank"><img src="https://cloud.githubusercontent.com/assets/556367/17194771/b6895ab6-540e-11e6-92db-02a7908df54d.png" alt="Styling OSM XML"></a></p>
<p>Take a look at this <a href="https://github.com/hallahan/tangram-es/blob/22437d806ab5f4f81429068726baee057d6aa14a/scenes/osm-xml-demo.yaml#L87-L131" _target="blank">scene.yaml</a>. Here you can see how we color different types of buildings based off of their building tag values.</p>
<p>Though it is easy to style and render OSM elements, the topology of the data is different from what you will find in a <a href="https://mapzen.com/documentation/vector-tiles/layers/" _target="blank">standard Mapzen vector tile</a>. When using Mapzen vector tiles, you can use Mapzen&apos;s <a href="https://mapzen.com/blog/updated-house-styles/" _target="blank">house styles</a> as-is, without any modification. When using another data source, it will be up to you to create your own style. For example, if you want to use vector tiles hosted by Mapbox, you will also have to create your own <code>scene.yaml</code> that renders the layers of data that Mapbox provides.</p>
<h2 id="further-details">Further Details</h2>
<p>Further details about this prototype can be found on the <a href="https://github.com/tangrams/tangram-es/issues/877" _target="blank">OSM XML Support</a> issue on the Tangram ES Github. Development can be found on the <a href="https://github.com/hallahan/tangram-es/tree/OSM_XML" _target="blank">OSM_XML branch</a> of my fork of the repo. </p>
<p>The <a href="https://github.com/hallahan/tangram-es/tree/OSM_XML/core/src/osm" _target="blank">OSM data model</a> is inspired by <a href="openmapkit/android.md">OpenMapKit Android</a> and <a href="https://github.com/hallahan/OSMSpatialite" _target="blank">OSMSpatialite</a>.</p>

                                    
                                    </section>
                                </div>
                                <div class="search-results">
                                    <div class="has-results">
                                        
                                        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
                                        <ul class="search-results-list"></ul>
                                        
                                    </div>
                                    <div class="no-results">
                                        
                                        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
                                        
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="mbtiles.html" class="navigation navigation-prev " aria-label="Previous page: Offline MBTiles Support">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="installation.html" class="navigation navigation-next " aria-label="Next page: Android Installation">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        // fix for detecting taps on book body for mobile and narrow screen
        function mobileSidebarCloseFix() {
            function checkToToggle(e) {
                if ($(window).width() <= 600 
                        && e.target.tagName !== 'I'
                        && e.target.tagName !== 'A'
                        && gitbook.sidebar.isOpen()) {
                    gitbook.sidebar.toggle();
                }
            }
            $bookbody = $('.book-body');
            $bookbody.click(function(e) {
                checkToToggle(e);
            });
            $bookbody.on('touchend', function(e) {
                checkToToggle(e);
            });
        }

        // make keyboard disappear when pressing go or enter when typing
        // in search input. fix for mobile behavior.
        function searchInputMobileFix() {
            $('#search-form').submit(function(e) {
                e.preventDefault();
                if(document.activeElement) {
                    document.activeElement.blur();
                    if ($(window).width() <= 600 && gitbook.sidebar.isOpen()) {
                        gitbook.sidebar.toggle();
                    }
                }
            });
        }

        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"description":"I have added an OSM XML data source to Tangram ES as a prototype to demonstrate Tangram ES' capability to be used in an OSM editor.","title":"OSM XML Data Source","level":"4.1.2","depth":2,"next":{"title":"Android Installation","level":"4.1.3","depth":2,"path":"modern-map-renderers/tangram-es/installation.md","ref":"modern-map-renderers/tangram-es/installation.md","articles":[]},"previous":{"title":"Offline MBTiles Support","level":"4.1.1","depth":2,"path":"modern-map-renderers/tangram-es/mbtiles.md","ref":"modern-map-renderers/tangram-es/mbtiles.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","anchorjs"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"fontsettings":{"theme":"white","family":"serif","size":2},"expandable-chapters":{},"anchorjs":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Nicholas Hallahan","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"modern-map-renderers/tangram-es/osm-xml-data-source.md","mtime":"2016-11-05T01:17:23.000Z","type":"markdown"},"gitbook":{"version":"3.0.3","time":"2016-11-05T02:59:40.537Z"},"basePath":"../..","book":{"language":""}});
            mobileSidebarCloseFix();
            searchInputMobileFix();
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/buttons.js"></script>
        
    

    </body>
</html>
